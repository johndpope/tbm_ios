Fix #383
========

PROBLEMS
--------
1) If a user generates two (or more) videos in succession. If the second one starts recording before the first one has finished processing the first one may be destroyed.

2) Multiple videos are sent to the same friend in a row the final outgoing file may be overwritten before it has had a chance to be picked up by the FileTransfer manager. (This case is very unlikely and I have not seen it since the first thing the file transfer manager does is copy the file to a temporary outgoing file.)


CAUSE
-----
In the current architecture we use the same file for:
  - Recording: new.mov
  - Converted: newConverted.mp4
  - Outgoing per friend: outgoingVidToFriend<friendId>
These files may be overwritten when a new video is created before FileTransferManager has a chance to copy to temporary file.


WORKABLE ARCHITECTURE
---------------------
New OutgoingVideoUrl for each new recording
FriendId and VideoId are encoded in OutgoingVideoUrl
VideoProcessor is instantiated each time a recording completes to handle processing
All notifications are handled using NotificationCenter

Test cases: C2454


<<<<<<< Local Changes
Fix #398
========

PROBLEM:
If the device is unable to generate a thumbnail it marks the video as failed permanently.


SOLUTION:
Always save friend.lastThumb for each friend. Use that one in case a new one fails.
- if friend.hasIncomingVideo of any kind
  - Always show a thumb
    - Try to get thumb from videos
    - Otherwise friend.lastThumb
    - Otherwise defaultThumb
- Only if not incoming video of any kind show record button.


TODO:
Algorithm:
- Friend.generateThumbWithVideo
  - if video.generateThumb
    - copy to Friend.lastThumb

- Friend.thumbUrl
  - friend.lastThumbUrl || defaultThumbUrl

- Do not mark the video failed permanently if thumb fails


TEST CASES:



Other bugs to fix:
- We should update kv store only after video has been uploaded.
-

- Notify user there was an error downloading video or error uploading video.
