v2.4.0

Rewrite VideoRecorder Code
--------------------------
 - Done:
   - Use PBJVision cocoapod
   - Significant refactoring, simplification, hardening, corner case handling.

 - Remaining TODO
  - Move UI messages out of VideoRecorder
  - Move 2 finger touch recognizer out of VideoRecorder
  - Create a GridPresenter+VideoRecorder category
  - Remove files tagged for removal. Their names contain the word deprecated.

- Testcases https://zazo.testrail.com/index.php?/plans/view/107



hotfix/848-ding-sound-recorded
------------------------------
 - Moved sound playing to ZZVideoRecorder
 - Added the appropriate delay there to prevent recording the sound.
 - Made sure to add delay to stop recording as well.


feature/auto-notification
-------------------------
 x Updated VideoFileHandler to add metadata
 x Updated local copy of FTM to put metadata in request
 x Push pod
 x Install pod
 x Test


hotfix/863-pbjvision_gl_crash
-----------------------------
 x Crash was due to PBJVision making GL calls while app is in background
 x Solution remove instantiation of GL in our version of PBJVision


hotfix/874-first-recording-after-reg
------------------------------------
Symptoms:
  1 Invite a user
  2 Send invite sms but no sim
  3 Notification from OS that no sim causes app to resign active
  4 Send welcome message
  ERROR: Video recorder never completes recording.

CAUSE:
  We deactivate audio session when we resign active to allow other apps to use the audio
  When we deactivate the audio session while preview is still showing we get an error
  Attempting to record when we become active again after this error fails

SOLUTION:
  Stop preview on applicationWillResignActive
  Start preview on applicationDidBecomeActive
  Give stop preview some time to complete before deactivating audio session.


hotfix/859-downloading-e-after-reg
----------------------------------
Symptoms:
  Delete and reinstall app with same user
  Notice that it attempts to download old videos that should have been deleted in kvstore

CAUSES:
  1) We were not deleting remote in case of failedPermanently, unrecoginzed Video
  2) We were using the wrong key to delete from remote.


hotfix/849-oncall-dialog
------------------------
Symptoms:
 - Call the phone answer the call
 - While on the call launch Zazo
 ER:
  - On a call dialog.
AR:
  - No dialog appears.
  - Camera preview hangs
  - Other interface elements remain active and operable

CAUSE:
On ios9 we do not get _sessionRuntimeErrored in case of trying to start preview while another app has mic or camera. We get interrupted again.

SOLUTION:
Show dialog on interrupted as well as errored.


hotfix/651-proximity-sensor
---------------------------
BUG:
 - Was not playing from earpiece when moved to ear

CAUSE:
 - Video recorder was configuring the audio session from under audioSession category.

SOLUTION:
 - Update PBJVision to allow setting automaticallyConfiguresApplicationAudioSession = NO
 - Release pod version 0.4.6
 - Update Zazo pod


remove-handle-incoming-call
---------------------------
PROBLEM:
  Explicit incoming call handling is not needed.
  Interruption while recording is handled automatically by ZZVideoRecorder.
  Playback is automomatically stopped by OS.

SOLUTION:
  Remove from code.


handle-stuck-downloads
----------------------
HandleStuckDownloads should be called on each active on before
It was not the cause of download e! problems.
Those were fixed in hotfix/859-downloading-e-after-reg

Tested handle stuck downloads for background notification with cellular coverage only on IOS 7 and it appears to be workig well.

Cleaned up unnecessary dispatch error in generateThumb


hotfix/878-upload-retry-after-kill
----------------------------------
STEPS:
 - IOS8+
 - Record a 30sec to 1min zazo
 - While uploading is in progress kill app
 - Note it is easier especially on an iphone6 to set network to very bad in order to have time to kill app while uploading.
 - Restart

CAUSE and ERROR EFFECTS:
 - On restart there was a bug in the file transfer manager which would set contentLength = 0 for retried requests
   - This would cause the upload request to fail and be retried continually
 - Autonotifcation 2.9.6 would trigger a notification for all requests even the error retires where no file was uploaded.
   - This would cause receiver to download e!
   - This would also cause multiple notifications to the receivers phone.

ASSOCIATED BUGS:
  - 878 - Uploading doesn't continue after Zazo was killed
  - 876 - Notification about new message appears twice when Zazo in background
  - 877 - Download e! after kill during downloading process
  - 832 - iOS 7. Random incoming message disappears


SOLUTION:
 - Fixed CLIENT filetransferManager v0.6.3
   - Always have contentLength for initial request as well as retried requests.
 - Fixed SERVER autonotification v2.9.7
   - Do not notify or update kv except for requests that successfully upload a file.


on-a-call-2
-----------
PROBLEM:
  - On a call alert needs to trigger on capture session interrupted for IOS9. But this trigger also occurs when we go into background due to lock screen button.

SOLUTION:
  - Gate trigger with background status.

OTHER:
  - Small clean up in VideoRecorder

TESTS
  - ios7, 8, 9
    - Background
    - Kill
    - Power button lock
    - Call while in app
    - Call while recording
    - Enter app while in call
    - Kill call while in app


on-a-call-3
-----------
PROBLEM:
  - In rare cases on ios 8.2 we get spurious on a call dialogs when not supposed to.

SOLUTION:
  - This is a bit of a hack but let videoRecorder attempt twice before showing a dialog.

TESTS
  - sx px b f
    - Background
    - Kill
    - Power button lock
    - Call while in app
    - Call while recording
    - Enter app while in call
    - Kill call while in app


